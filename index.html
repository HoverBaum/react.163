
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ReactJS</title>
        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="theme/uzl.css" id="theme">
        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
          document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>
		<script>
		  document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
		  ':35729/livereload.js?snipver=1"></' + 'script>')
		</script>
    </head>
    <body>

        <div class="reveal">
            <div class="slides"><section ><section data-markdown><script type="text/template"># ReactJS

### Structuring development
</script></section><section data-markdown><script type="text/template">
### Obligatory introduction

Hi, I am Hendrik üôã

Find me online:

- [GitHub](https://github.com/HoverBaum)
- [Website](http://hendrikwallbaum.de/)
- [Blog](http://hoverbaum.gitlab.io/2016/07/21/Why-and-how-to-ReactJS/)
</script></section><section data-markdown><script type="text/template">
### ES6

The code in this presentation makes heavy use of [*ES6*](http://es6-features.org/). If you are not familiar with the syntax please look it up.

- [Arrow Functions](http://es6-features.org/#ExpressionBodies)
- [Constants](http://es6-features.org/#Constants)
- [Object.assign](http://es6-features.org/#ObjectPropertyAssignment)
- [Default values for parameters](http://es6-features.org/#DefaultParameterValues)
- [Exporting and importing](http://es6-features.org/#ValueExportImport)

Here is a [summarz of the above](http://hoverbaum.gitlab.io/2016/07/25/ES6-need-to-know/) or read [a full introduction to ES6 features](https://github.com/lukehoban/es6features).
</script></section></section><section ><section data-markdown><script type="text/template">
# üíÅ An introduction
</script></section><section data-markdown><script type="text/template">
[*ReactJS*](https://facebook.github.io/react/) takes a simple enough approach:

> For a given state describe how to render your application.
</script></section><section data-markdown><script type="text/template">
### üíÅ Basic Example

```javascript
import React from 'react';
import { render } from 'react-dom';

render (
    <div>
        Hello React
    </div>,
    document.getElementById('#app')
)
```

<aside class="notes" data-markdown>Components need to be wrapped in a single parent.</aside></script></section><section data-markdown><script type="text/template">
### üíÅ Components

A *Component* is a description of how to render a part of our application, like a button.

```javascript
//A simple button component.
import React from 'react';

const button = ({disabled, text, click}) => (
    <button onClick={disabled ? () => {} : click} >
        {text}
    </button>
)

export default button
```

<aside class="notes" data-markdown>Uses Destructuring to achieve named paramteres that is where the `{}` come from.</aside></script></section><section data-markdown><script type="text/template">
### üíÅ Beyond the display

ReactJS renders our application.

Thus we need concepts and tools to compliment ReactJS when we want to build an application.

We need an approach to handle the state that is to be rendered.
</script></section></section><section ><section data-markdown><script type="text/template">
# üì¶ Redux

> Redux is a predictable state container for JavaScript apps.
</script></section><section data-markdown><script type="text/template">
### üì¶ Reduxes idea

A popular approach to handle this `state` that ReactJS renders is [*Redux*](http://redux.js.org/).

It takes a unidirectional approach to dataflow. Meaning data only flows in a single direction. This makes our application more predictable.
</script></section><section data-markdown><script type="text/template">
<img id="flowDiagram" src="res/redux-flow.png" style="height: 45vh;padding: 3rem;" />
<label for="flowDiagram">
    Visualizing dataflow in Redux
</label>
</script></section><section data-markdown><script type="text/template">
### üì¶ Store

The *Store* is the current representation of the state of your application.

```javascript
//The store is simply one big object in JavaScript.
{
    printing: false,
    orders: [...]
}
```
</script></section><section data-markdown><script type="text/template">
### üì¶ Actions

You can think of this as an event. While the *Action* is the actual thing being propagated there are also *Actioncreators* which are functions used to create an action.

```javascript
//Use ES6 Syntax to define a function.
export const startPrinting = () => {
    return {
        type: 'PRINTING_START'
    }
}
```
</script></section><section data-markdown><script type="text/template">
### üì¶ Reducers

*Reducers* are function that take a current store and return a new one based on an Action.

```javascript
//Return a state for the action or a standard one.
const printing = (state = false, action) => {
    if(action.type === 'PRINTING_START') {
        return true
    } else if(action.type === 'PRINTING_STOP') {
        return false
    } else {
        return state
    }
}
```
</script></section><section data-markdown><script type="text/template">
### üì¶ Combining Reducers

```javascript
import { combineReducers } from 'redux';
import printing from './printing';
import orders from './orders';

const reducers = combineReducers({
  printing,
  orders
})

export default reducers
```

```javascript
const store = createStore(reducers)
```

<aside class="notes" data-markdown>This can then be used for `createStore` to build the store.
Just things Redux provides.</aside></script></section><section data-markdown><script type="text/template">
### üì¶ Using the Store

```html
<Provider store={store}>
    <div>
        <Button text="Invert" />
    </div>
</Provider>
```
</script></section></section><section ><section data-markdown><script type="text/template">
# ‚û° Pure and Immutable
</script></section><section data-markdown><script type="text/template">
### ‚û° Pure Functions

A pure function is one that fulfills two conditions:

- For a given input it always returns the same output
- It has no *"side effects"*
</script></section><section data-markdown><script type="text/template">
### ‚û° Pure Components

```javascript
const button = ({disabled, text, click}) => (
    <button onClick={disabled ? () => {} : click} >
        {text}
    </button>
)
```

Our example from earlier is a pure function.
</script></section><section data-markdown><script type="text/template">
#### ‚û° Impure Component

```javascript
import React from 'react';

let clicked = false
const doubleButton = ({click}) => {
	<button onClick={clicked ? click() : () => {clicked = true}}
		Click me twice
	</button>
}
export default doubleButton
```

Don't put state in your Components!
</script></section><section data-markdown><script type="text/template">
### ‚û° Immutable

> An immutable object is an object whose state cannot be modified after it is created
</script></section><section data-markdown><script type="text/template">
<img id="flowDiagram" src="res/updateStore1.png" style="height: 45vh;padding: 3rem;" />
</script></section><section data-markdown><script type="text/template">
<img id="flowDiagram" src="res/updateStore2.png" style="height: 45vh;padding: 3rem;" />
</script></section><section data-markdown><script type="text/template">
<img id="flowDiagram" src="res/updateStore.png" style="height: 45vh;padding: 3rem;" />
</script></section><section data-markdown><script type="text/template">
### ‚û° Code example

Consider an array of Objects containing an id and some text.

```javascript
[
	{
		id: 'a unique ID here',
		text: 'this is some text'
	}, ...
]
```

Lets look at how to update a single Object in this array
</script></section><section data-markdown><script type="text/template">
### ‚û° Code example

```javascript
function updateTextForId(array, id, newText) {
    return array.map(obj => {
        if(obj.id === id) {

            //Create a new object only where it is needed with the
			//updated text.
            return Object.assign({}, obj, {
                text: newText
            })
        } else {

            //Else just use the old object.
            return obj
        }
    })
}
```
</script></section><section data-markdown><script type="text/template">
### ‚û° Gains

- Testability
- Predictability
- Timetravel

We gain a lot from making our Components and Reducers pure functions and also from making our Reducers work with immutable Objects.
</script></section></section><section ><section data-markdown><script type="text/template">
# ‚Üî Routing
</script></section><section data-markdown><script type="text/template">
### ‚Üî Single page Application

[react-router](https://github.com/reactjs/react-router) is a complete routing library for React.

```javascript
render(
	< Provider store={store} >
		<Router history={history}>
			<Route path="/" component={App}>
				<IndexRoute component={Orders}  />
				<Route path="order/:orderId" component={OrderDetail} />
				<Route path="package/:orderId" component={Package} />
				<Route path="add/:packId" component={AddPackage} />
			</Route>
		</Router>
    < /Provider>,
    document.getElementById('app')
)
```
</script></section><section data-markdown><script type="text/template">
### ‚Üî Design decision: Login

FTL and backend handle *Login* and *Main* page, after that it is a single page application.

- Login in SPA is hard
- Frontend models things the backend does not care about
- Want to use React but backend uses FTL: only implement a Component in one language
	- [isomorphic approach](https://github.com/DavidWells/isomorphic-react-example) would be an improvement

</script></section></section><section ><section data-markdown><script type="text/template">
# üìã Folderstructure
</script></section><section data-markdown><script type="text/template">
### üìã Overview

```text
.
‚îú‚îÄ‚îÄ docs                        All documentation lives here
‚îÇ   ‚îú‚îÄ‚îÄ actions                 Redux Action documentation
‚îÇ   ‚îú‚îÄ‚îÄ config                  Config to generate docs
‚îÇ   ‚îî‚îÄ‚îÄ templates               Templates to generate docs
‚îú‚îÄ‚îÄ node_modules                NPM dependencies
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ cssPre                  Your CSS preprocessing language of choice
‚îÇ   ‚îú‚îÄ‚îÄ img                     Image resources
‚îÇ   ‚îî‚îÄ‚îÄ js                      JavaScript files
‚îú‚îÄ‚îÄ test
‚îÇ   ‚îú‚îÄ‚îÄ reducers                Testing your reducers
‚îÇ   ‚îî‚îÄ‚îÄ test.js                 Entry point for all tests
‚îî‚îÄ‚îÄ webpack.config.js           Webpack configuration
```
</script></section><section data-markdown><script type="text/template">
### üìã JS Folderstructure

```text
.
‚îú‚îÄ‚îÄ actions
‚îÇ   ‚îî‚îÄ‚îÄ index.js                Your Actioncreators
‚îú‚îÄ‚îÄ components                  Visible components
‚îÇ   ‚îú‚îÄ‚îÄ button.js
‚îÇ   ‚îî‚îÄ‚îÄ orderList.js
‚îú‚îÄ‚îÄ containers                  Redux containers
‚îÇ   ‚îî‚îÄ‚îÄ visibleOrderList.js
‚îú‚îÄ‚îÄ index.js                    The main entry point
‚îî‚îÄ‚îÄ reducers                    Reducers for each part of the store
    ‚îú‚îÄ‚îÄ index.js
    ‚îî‚îÄ‚îÄ ordersReducer.js
```
</script></section><section data-markdown><script type="text/template">
Folderstructure helps especially to quickly find the JS files to work on, mainly distinguishing between:

- Reducers
- Components
- Containers
- Actions
</script></section></section><section ><section data-markdown><script type="text/template">
# üî® Buildprocess
</script></section><section data-markdown><script type="text/template">
ES6 and JSX need transpiling.

(Maybe also Polyfills)

</script></section><section data-markdown><script type="text/template">
### üî® Webpack

Get the [config file](https://gist.github.com/HoverBaum/2dec64c7395529e9bb93af92d7c7e544#file-webpack-config-js) and setup an [npm script](https://docs.npmjs.com/misc/scripts).

```javascript
"webpack": "node node_modules/webpack/bin/webpack.js
 	--progress --colors --watch"
```

```bash
$ npm run webpack

> react-basic@0.1.0 webpack D:\react-basic
> node node_modules/webpack/bin/webpack.js --progress --colors --watch

Hash: 9f2265bc4db2c1e07831
Version: webpack 1.13.1
Time: 1810ms
      Asset    Size  Chunks             Chunk Names
    main.js  727 kB       0  [emitted]  main
main.js.map  849 kB       0  [emitted]  main
    + 172 hidden modules
```

<aside class="notes" data-markdown>That should be one line but looks better like this on slides.</aside></script></section><section data-markdown><script type="text/template">
### üî® See the result

Create an `index.html` in your build folder and use [live-server](https://www.npmjs.com/package/live-server) to see the result.

```JavaScript
"serve": "./node_modules/.bin/live-server ./build"
```

| pros | cons |
|:---:|:---:|
| fast refresh | no FTL |

But we can substitute [puer-freemarker](https://www.npmjs.com/package/puer-freemarker) to get only the pros and response mocking.

<aside class="notes" data-markdown>Project used FTL for server side rendering.</aside></script></section><section data-markdown><script type="text/template">
### üî® Different Webpack builds

Use an environment variable to define the build folder.

```javascript
//npm script
"webpack-dev": "set DEV=true && node node_modules/webpack/bin/webpack.js"

//Calculate different folder based in variable.
function outputFolder() {
	if(process.env.DEV.trim() === 'true') {
		return 'res'
	}
	return 'devBuild'
}

//In the config object
output: {
    path: path.join(__dirname, outputFolder(), 'js'),
    filename: "[name].js"
}
```
</script></section></section><section ><section data-markdown><script type="text/template">
# üöß Implementing a feature

<aside class="notes" data-markdown>Until here was the pain, now comes the gain.</aside></script></section><section data-markdown><script type="text/template">
### üöß Three steps

1. Build the Components
2. Build the Reducer
3. Connect them

<aside class="notes" data-markdown>This is really amazing. Makes it predictable how complex things are.</aside></script></section></section><section ><section data-markdown><script type="text/template">
# ‚öô Debugging
</script></section><section data-markdown><script type="text/template">
### ‚öô Find the problem

When you look at a problem with an app build on React and Redux there are three types of possible problems:

1. Rendering errors
2. State miscalculation
3. Problems connecting the Store to Components
</script></section><section data-markdown><script type="text/template">
<img id="flowDiagram" src="res/debugReactReduxFlowChart.png" style="height: 45vh;padding: 3rem;" />
<label for="flowDiagram">
    Find the source of a bug
</label>
</script></section><section data-markdown><script type="text/template">
### ‚öô React DevTools

Get the [Chrome extension](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi).

- See what properties got handed to a Component
- Find out if its a Component or connection problem
</script></section><section data-markdown><script type="text/template">
### ‚öô Log Actions and state

Redux can be extended using [middleware](http://redux.js.org/docs/advanced/Middleware.html). That same page suggests how to implement a [logging middleware](https://gist.github.com/HoverBaum/022905d9c6ca4f7fcd06664ea7e63415).

```javascript
import { createStore, combineReducers, applyMiddleware } from 'redux';
import { logger, crashReporter } from './loggingMiddleware';

let store = createStore(
  reducers,
  applyMiddleware(logger, crashReporter)
)
```

<aside class="notes" data-markdown>Redux also has devtools but they are a pain to set up. More pain then gain.</aside></script></section><section data-markdown><script type="text/template">
#### ‚öô Example logs

```javascript
next state
 Object {printing: false, orders: []}
dispatching
 Object {type: "PRINTING_START"}
next state
 Object {printing: false, orders: []}
 ```
</script></section><section data-markdown><script type="text/template">
### ‚öô Sourcemaps

> Using source maps allows developers to maintain a straight-forward debugging environment while at the same time optimizing their sites for performance.

Get pointed to `reducers/printing line: 13`
instead of `build.js line: 13758`.

<aside class="notes" data-markdown>Chrome `Ctrl+P` to open file in Source tab of devtools.
Super helpful thing sourcemaps.</aside></script></section></section><section ><section data-markdown><script type="text/template">
# üîß Testing
</script></section><section data-markdown><script type="text/template">
### üîß What and how

**Components**: manually

**Reducers**: unit tests
</script></section><section data-markdown><script type="text/template">
### üîß Reducers

Since our reducers are pure functions they are an ideal thing to test.

[*Tape*](https://github.com/substack/tape) is a lightweight testing framework for JavaScript. Let's look at how to use it for our ReactJS application.
</script></section><section data-markdown><script type="text/template">
### üîß Setup

A nice Tape environment with some pretty output and the ability to use ES6 `import` requires a bit of setup and an npm script.

```bash
npm install --save-dev tap-spec tape browserif babelify deep-freeze-node
```

```JavaScript
"test": "node ./node_modules/browserify/bin/cmd.js test/test.js
	-t [ babelify --presets [ es2015 react ] ] | node | tap-spec"
```
</script></section><section data-markdown><script type="text/template">
### üîß Testfiles

```text
.
‚îú‚îÄ‚îÄ reducers
‚îÇ   ‚îú‚îÄ‚îÄ orders.js               Testing orders reducer
‚îÇ   ‚îî‚îÄ‚îÄ printing.js             Testing printing reducer
‚îî‚îÄ‚îÄ test.js                     Entry point for all tests
```

```javascript
//test.js
const test = require('tape')

require('./reducers/order')(test)
require('./reducers/printing')(test)
```
</script></section><section data-markdown><script type="text/template">
### üîß Simple testcase

```javascript
import printReducer from '../../src/js/reducers/printing';
import { startPrinting } from '../../src/js/actions';

module.exports = function testText(test) {
    test('Printing', function(t) {

        const store1 = printReducer(undefined, {})
        t.equal(store1, false, 'Initial Value correct')

        const secondText = 'Hello World'
        const store2 = printReducer(store1, startPrinting())
		t.equal(store2, true, 'Started printing')

		//More tests here and thens end this test case.
        t.end()
    })
}
```
</script></section></section><section ><section data-markdown><script type="text/template">
# üéì Lessons learned
</script></section><section data-markdown><script type="text/template">
### üéì Normalize the Store

Three weeks into development and suddenly all I do is dive deep into nested objects to find correlating ones.

Pull Objects out, give them IDs and reference those.
</script></section><section data-markdown><script type="text/template">
#### üéì Before

```javascript
orders: [
	{
		orderId: 'ordersId',
		name: 'John Doe',
		packs: [
			{
				packId: 'packId'
			}, ...
		]
	}, ...
]
```

At `/pack/packId` which is the corresponding order?
</script></section><section data-markdown><script type="text/template">
#### üéì After


```javascript
orders: [
	{
		orderId: 'ordersId',
		name: 'John Doe',
		packs: ['packId', ...]
	}, ...
],
packs: [
	{
		packId: 'packId',
		orderId: 'orderId'
	}, ...
]
```
</script></section><section data-markdown><script type="text/template">
### üéì Compute in Components

**Task**: given the already delivered items and the total amount of items that need delivering, calculate the packages that need to be delivered.

Influenced by the Order which has all things that need delivering and packaged packs.
</script></section><section data-markdown><script type="text/template">
#### üéì In Reducers

Have both the *Orders* and *packs* Reducer calculate a *toBeDelivered*.

**Problems:**
- Reducers only know their own space in the Store
- Where should this be saved
- Create a way to only implement this once

**Result:** super messy and buggy
</script></section><section data-markdown><script type="text/template">
#### üéì In Component

There is only one component which wants to display this and if we have the packs and the order this is a simple transformation.

**Benefits:**
- Single point of implementation
- Less code
- Easier to reason about
</script></section></section><section ><section data-markdown><script type="text/template">
# üìì Links

Helpful things and further reading.

This presentation is on [GitHub](https://github.com/HoverBaum/react.163)
</script></section><section data-markdown><script type="text/template">
### üìì Follow the links

- [Introducing React](https://www.youtube.com/watch?v=XxVg_s8xAms) (üé¨)
- [ReactJS repos](https://github.com/reactjs/)
- [Redux docs](http://redux.js.org/)
- [Blogpost](http://hoverbaum.gitlab.io/2016/07/21/Why-and-how-to-ReactJS/) me on how to set this all up
- [Basic setup](https://github.com/HoverBaum/react-basic) repo with basic setup as discussed here
</script></section><section data-markdown><script type="text/template">
### üìì This is build using:

- [Reveal](https://github.com/hakimel/reveal.js/) for JS based slides
- [Reveal-md](https://github.com/webpro/reveal-md) for prototyping
- [nodetree](https://www.npmjs.com/package/nodetree) for nice filetrees
- [RevealUzL](https://github.com/UzLMaennchen/revealUzL) theme for Reveal
</script></section><section data-markdown><script type="text/template">
# Code on

<!-- Create some styles -->
<style>
    @media print {
        img {
            min-height: 300px;
        }
    }
</style>
</script></section></section></div>
        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>
            function extend() {
              var target = {};
              for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                  if (source.hasOwnProperty(key)) {
                    target[key] = source[key];
                  }
                }
              }
              return target;
            }

            // Optional libraries used to extend on reveal.js
            var deps = [
              { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
              { src: 'plugin/math/math.js', async: true }
            ];

            // default options to init reveal.js
            var defaultOptions = {
              controls: true,
              progress: true,
              history: true,
              center: true,
              transition: 'default',
              dependencies: deps
            };

            // options from URL query string
            var queryOptions = Reveal.getQueryHash() || {};

            var options = {
  "transition": "slide",
  "previewLinks": true
};
            options = extend(defaultOptions, options, queryOptions);
            Reveal.initialize(options);
        </script>

          <script src="/scripts/react"></script>
    </body>
</html>
